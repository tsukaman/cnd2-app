# 技術的負債 TODO リスト

*最終更新: 2025-09-05*

このドキュメントは、コードレビューで指摘された改善項目と技術的負債を記録し、将来の開発で対応すべき項目を管理するためのものです。

## 📊 優先度の定義

- 🔴 **高優先度**: 次のスプリントで対応すべき項目
- 🟡 **中優先度**: 2-3スプリント以内に対応したい項目  
- 🟢 **低優先度**: 時間があるときに対応する項目

## 🔴 高優先度タスク

### ~~1. プロフィール変換処理の共通化~~ ✅ 完了済み (2025-09-05)
**問題**: プロフィール変換ロジックが複数箇所に重複している

**解決案** (実装済み):
- `src/lib/utils/profile-converter.ts` - TypeScript版を作成 ✅
- `functions/utils/profile-converter.js` - JavaScript版を作成 ✅
- 両環境で共通関数（convertToFullProfile, convertProfilesToFullFormat等）を提供 ✅
- 全APIエンドポイントで共通モジュールを使用 ✅

**達成効果**: 
- コード重複の完全削減（約50行削除）
- 一元管理による保守性向上
- TypeScript/JavaScript両環境での互換性確保

---

### 2. デバッグログのセキュリティ強化
**問題**: `DEBUG_MODE`環境変数で詳細ログが有効化される仕組みが本番環境でリスクとなる可能性

**影響**:
- 本番環境での機密情報漏洩リスク
- パフォーマンスへの影響

**解決案**:
- 本番環境では`NODE_ENV=production`時にDEBUG_MODE強制無効化
- ログレベル管理システムの導入（ERROR, WARN, INFO, DEBUG）
- 構造化ログの実装

**期待効果**:
- セキュリティリスクの軽減
- 運用時のトラブルシューティング改善

## 🟡 中優先度タスク

### 3. 開発環境でのKV処理の最適化
**問題**: 開発環境ではLocalStorageのみ使用する設計だが、KVアクセスコードが残存

**影響**:
- 不要なエラーハンドリング
- 開発環境での混乱

**解決案**:
```javascript
if (env.NODE_ENV === 'development') {
  // LocalStorageのみ使用
  return;
}
// KV処理
```

**期待効果**:
- 開発環境の簡素化
- エラーログの削減

---

### ~~4. エラーメッセージの統一管理~~ ✅ 完了済み (2025-09-05)
**問題**: APIごとに異なるエラーメッセージ形式

**影響**:
- フロントエンドでの一貫性のないエラー表示
- 国際化対応の困難さ

**解決案** (実装済み):
- `lib/constants/error-messages.ts`でエラーコードとメッセージを一元管理 ✅
- `lib/utils/error-response.ts`で統一エラーレスポンス形式を実装 ✅
- `functions/utils/error-messages.js`でCloudflare Functions用も統一 ✅
- 全APIエンドポイントで統一形式を適用 ✅

**達成効果**:
- 統一的なエラーレスポンス形式の実現
- 日本語/英語の国際化対応
- 後方互換性を維持しつつ新システムへ移行

## 🟢 低優先度タスク

### 5. CNCFプロジェクト選択テストの追加
**問題**: PR #189で実装されたCNCFプロジェクト選択機能のテストが不足

**解決案**:
- 207個のプロジェクトからのランダム選択ロジックのテスト
- カテゴリー分類（Graduated/Incubating/Sandbox）のテスト

---

### 6. Prairie Card URL検証の改善
**現状**: `my.prairie.cards`のみ許可（正しい実装）

**将来的な検討事項**:
- URLエンコードされた日本語ユーザー名のサポート
- URL長さ制限の実装（現在は無制限）

---

### 7. テストコードのリファクタリング
**改善提案**: `describe.each`を使用したテストコードの簡潔化

```typescript
describe.each([
  ['javascript:', '危険なプロトコル'],
  ['data:', 'データプロトコル']
])('プロトコル %s の拒否', (protocol, description) => {
  // テストケース
});
```

## 📝 実装済み項目（記録用）

### ✅ 完了済み
- プロフィール変換処理の共通化（2025-09-05）
  - TypeScript/JavaScript両環境用のprofile-converterモジュール作成
  - 重複コード約50行を削減
  - 全APIエンドポイントで共通モジュールを使用
- エラーメッセージの統一管理（2025-09-05）
  - 統一エラーコード定義ファイル作成
  - TypeScript/JavaScript両環境対応
  - 国際化対応（日本語/英語）
  - 後方互換性の維持
- Prairie Card URL検証のセキュリティ強化（PR #195 - 2025-09-05）
- Prairie Card URL検証テストの追加（PR #197 - 2025-09-05）
- 不要ファイルの大規模削除（PR #190 - 2025-09-05）
- CORS設定の統一とセキュリティ強化（PR #195 - 2025-09-05）
- AbortControllerによるタイムアウト処理（PR #195 - 2025-09-05）

## 🔄 継続的改善

### コードレビューで見つかった改善点の管理プロセス
1. レビューコメントをこのドキュメントに記録
2. 優先度を設定
3. スプリント計画時に高優先度項目から対応
4. 完了後は「実装済み項目」セクションに移動

### 定期レビュー
- 月1回、このドキュメントをレビュー
- 優先度の見直し
- 新規項目の追加

## 📊 メトリクス

### 技術的負債の削減状況
- 2025年9月: 7項目の改善項目を特定
- 目標: 3ヶ月以内に高優先度項目を完了

### コード品質指標
- 重複コード: 
  - プロフィール変換: 約50行（2ファイル）
  - 目標: 共通化により0行に削減
- テストカバレッジ: 現在のカバレッジを維持しつつ改善
- エラー処理の一貫性: 4つのAPIで異なる形式（目標: 統一）

---

*このドキュメントは生きているドキュメントです。継続的に更新し、技術的負債の管理と削減に活用してください。*