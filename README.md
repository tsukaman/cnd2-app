# CNDÂ² - CloudNative Days Ã— Connect 'n' Discover

<div align="center">
  <img src="public/images/trademark@4x.png" alt="CloudNative Days Winter 2025" width="200"/>
  
  **ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®å‡ºä¼šã„ã‚’ã€ãƒ‡ãƒ¼ã‚¿ã§å¯è¦–åŒ–ã™ã‚‹**
  
  [![Next.js](https://img.shields.io/badge/Next.js-15.5.0-black?logo=next.js)](https://nextjs.org/)
  [![TypeScript](https://img.shields.io/badge/TypeScript-5.0%20strict-blue?logo=typescript)](https://www.typescriptlang.org/)
  [![Tailwind CSS](https://img.shields.io/badge/Tailwind-4.0-38B2AC?logo=tailwind-css)](https://tailwindcss.com/)
  [![Jest](https://img.shields.io/badge/Jest-30.0-C21325?logo=jest)](https://jestjs.io/)
  [![License](https://img.shields.io/badge/License-Apache%202.0-green.svg)](https://opensource.org/licenses/Apache-2.0)
  
  **#CNDxCnD**
</div>

## ğŸ“‹ æ¦‚è¦

**CNDÂ²ï¼ˆCloudNative Days Ã— Connect 'n' Discoverï¼‰** ã¯ã€CloudNative Days Winter 2025ï¼ˆ11æœˆ18-19æ—¥ @ æ±äº¬ï¼‰ã®ãŸã‚ã®ç‰¹åˆ¥ãªç›¸æ€§è¨ºæ–­ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚Prairie Cardã®æƒ…å ±ã‚’åŸºã«ã€ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢åŒå£«ã®æŠ€è¡“çš„ãªç›¸æ€§ã‚„å”åƒã®å¯èƒ½æ€§ã‚’å¯è¦–åŒ–ã—ã€ã€Œå‡ºä¼šã„ã‚’äºŒä¹—ã§ã‚¹ã‚±ãƒ¼ãƒ«ã€ã—ã¾ã™ã€‚

### âœ¨ ä¸»ãªæ©Ÿèƒ½

- **2äººè¨ºæ–­ãƒ¢ãƒ¼ãƒ‰**: 2äººã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ç›¸æ€§ã‚’è©³ç´°ã«åˆ†æ
- **ã‚°ãƒ«ãƒ¼ãƒ—è¨ºæ–­ãƒ¢ãƒ¼ãƒ‰**: 3-6äººã®ãƒãƒ¼ãƒ ã®ç›¸æ€§ã¨å”åƒå¯èƒ½æ€§ã‚’è©•ä¾¡ï¼ˆ6äººãªã‚‰6Â²=36é€šã‚Šã®ç›¸æ€§ï¼‰
- **å‹•çš„ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°**: 0-100%ã®å…¨ç¯„å›²ã§ç›¸æ€§ã‚’è©•ä¾¡ï¼ˆä½ã‚¹ã‚³ã‚¢ã§ã‚‚ãƒã‚¸ãƒ†ã‚£ãƒ–ãªä½“é¨“ï¼‰
- **Prairie Cardé€£æº**: Edge Runtimeå¯¾å¿œã®é«˜é€Ÿãƒ‘ãƒ¼ã‚µãƒ¼ã§è‡ªå‹•ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
- **AIè¨ºæ–­**: OpenAI GPT-4o-miniã‚’ä½¿ç”¨ã—ãŸé«˜åº¦ãªç›¸æ€§åˆ†æï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿæ§‹ä»˜ãï¼‰
- **çµæœå…±æœ‰**: QRã‚³ãƒ¼ãƒ‰ã‚„NFCã€URLã§ã®è¨ºæ–­çµæœã‚·ã‚§ã‚¢æ©Ÿèƒ½ï¼ˆé™çš„ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå¯¾å¿œï¼‰
- **ç¾ã—ã„UI**: ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒãƒ™ãƒ¼ã‚¹ã®æ´—ç·´ã•ã‚ŒãŸãƒ‡ã‚¶ã‚¤ãƒ³
- **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼é…æ…®**: è¨ºæ–­çµæœã¯7æ—¥å¾Œã«è‡ªå‹•å‰Šé™¤
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–**: HTML sanitization & XSS protectionå®Œå‚™
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: 10 requests/minute per IPï¼ˆæ‚ªç”¨é˜²æ­¢ï¼‰

## ğŸ”§ é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

**é‡è¦**: ã™ã¹ã¦ã®å¤‰æ›´ã¯ Pull Request çµŒç”±ã§æå‡ºã—ã¦ãã ã•ã„ã€‚main ãƒ–ãƒ©ãƒ³ãƒã¸ã®ç›´æ¥ãƒ—ãƒƒã‚·ãƒ¥ã¯ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚
è©³ç´°ã¯ [CLAUDE.md](./CLAUDE.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸš€ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **Framework**: Next.js 15.5.0 (App Router + Turbopack)
- **Language**: TypeScript 5.0 with strict mode enabled
- **Styling**: Tailwind CSS 4.0
- **Animation**: Framer Motion 12.23, Three.js, GSAP 3.13
- **Icons**: Lucide React
- **Validation**: Zod 3.25

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **Dual API Implementation**: 
  - Next.js API Routes (src/app/api/*) for developmentï¼ˆä¸€éƒ¨æœªå®Ÿè£…ï¼‰
  - Cloudflare Pages Functions (functions/*) for production
  - **AIè¨ºæ–­ã‚¨ãƒ³ã‚¸ãƒ³**: OpenAI GPT-4o-miniçµ±åˆï¼ˆv1.5.0ï¼‰
  - **çµæœå…±æœ‰**: ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å½¢å¼ `/duo/results?id=[id]`ï¼ˆé™çš„ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå¯¾å¿œï¼‰
- **Runtime**: Edge Runtime compatible
- **AI Integration**: OpenAI API (GPT-4o-mini) with 10s timeout
- **Data Storage**: Cloudflare Workers KV (7æ—¥é–“è‡ªå‹•å‰Šé™¤)
- **Data Parsing**: Edge Runtime compatible Prairie Card parser
- **Rate Limiting**: 10 requests/minute per IP (in-memory store for Edge compatibility)
- **Security**: 
  - HTML sanitization (ã‚«ã‚¹ã‚¿ãƒ ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼å®Ÿè£…)
  - XSS protection
  - å†å¸°çš„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
- **Error Handling**: 
  - æ§‹é€ åŒ–ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° + ç’°å¢ƒåˆ¥ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«åˆ¶å¾¡
  - ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—åˆ¥ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆ400, 408, 500ï¼‰
- **CORS**: è¤‡æ•°ã‚ªãƒªã‚¸ãƒ³ã‚µãƒãƒ¼ãƒˆï¼ˆç’°å¢ƒå¤‰æ•°è¨­å®šå¯èƒ½ï¼‰

### ãƒ†ã‚¹ãƒ†ã‚£ãƒ³ã‚°
- **Test Runner**: Jest 30.0
- **Testing Library**: React Testing Library 16.3
- **Coverage**: 76ãƒ†ã‚¹ãƒˆã€åŒ…æ‹¬çš„ãªã‚«ãƒãƒ¬ãƒ¼ã‚¸

### ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
- **Hosting**: Cloudflare Pages/Workers (æ¨å¥¨)
- **Storage**: Cloudflare Workers KV (è¨ºæ–­çµæœã®æ°¸ç¶šåŒ–ã€LocalStorageãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä»˜ã)
- **Monitoring**: Sentry (ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–)
- **Logging**: ç’°å¢ƒåˆ¥ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«åˆ¶å¾¡ï¼ˆæœ¬ç•ªç’°å¢ƒã§æ©Ÿå¯†æƒ…å ±è‡ªå‹•ã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼‰
- **Environment Validation**: Zodã«ã‚ˆã‚‹å‹å®‰å…¨ãªç’°å¢ƒå¤‰æ•°
- **API Security**: 
  - ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆ10 requests/minute per IPï¼‰ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDè¿½è·¡
  - HTML sanitizationï¼ˆDOMPurifyï¼‰ã€XSS protection
  - CORSï¼ˆè¤‡æ•°ã‚ªãƒªã‚¸ãƒ³ã‚µãƒãƒ¼ãƒˆï¼‰
  - APIã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ10ç§’ï¼‰
- **Secrets Management**: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ã¿ã§ã®APIã‚­ãƒ¼ç®¡ç†
- **CSP**: Content Security Policyè¨­å®šï¼ˆXSSå¯¾ç­–å¼·åŒ–ï¼‰

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- **Bundle Analysis**: webpack-bundle-analyzerã«ã‚ˆã‚‹ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºåˆ†æ
- **Image Optimization**: Next/Imageã«ã‚ˆã‚‹ç”»åƒæœ€é©åŒ–ã¨WebPè‡ªå‹•å¤‰æ›
- **Lazy Loading**: Intersection Observerã«ã‚ˆã‚‹é…å»¶èª­ã¿è¾¼ã¿
- **Code Splitting**: å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰åˆ†å‰²
- **Edge Runtime**: Cloudflare Workersã§ã®ã‚¨ãƒƒã‚¸å®Ÿè¡Œ

## ğŸ“¦ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### å‰ææ¡ä»¶
- Node.js 20.0.0ä»¥ä¸Š
- npm 10.0.0ä»¥ä¸Š

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/tsukaman/cnd2-app.git
cd cnd2-app

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
cp .env.example .env.local
# .env.localã‚’ç·¨é›†ã—ã¦å¿…è¦ãªå€¤ã‚’è¨­å®š
```

### ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

`.env.local`ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼š

```bash
# OpenAI APIï¼ˆå¿…é ˆï¼‰
OPENAI_API_KEY=your-api-key-here

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³URL
NEXT_PUBLIC_APP_URL=http://localhost:3000

# CORSè¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001

# ç’°å¢ƒè¨­å®š
NODE_ENV=development  # development | production
ENABLE_FALLBACK=false  # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨ºæ–­åˆ¶å¾¡ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: falseï¼‰

# Sentryè¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
SENTRY_DSN=your-sentry-dsn
NEXT_PUBLIC_SENTRY_DSN=your-sentry-dsn

# ãã®ä»–ã®è¨­å®šã¯.env.exampleã‚’å‚ç…§
```

## ğŸ”§ é–‹ç™º

```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ï¼ˆTurbopackä½¿ç”¨ï¼‰
npm run dev

# ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
npm test

# ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒ¼ã‚¸ã‚’ç¢ºèª
npm test -- --coverage

# ãƒªãƒ³ãƒˆå®Ÿè¡Œ
npm run lint

# å‹ãƒã‚§ãƒƒã‚¯
npm run type-check

# ãƒ“ãƒ«ãƒ‰
npm run build

# ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºåˆ†æ
npm run analyze

# ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•
npm start
```

## ğŸš§ APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### Next.js API Routes (Development)
Located in `src/app/api/*` - Used for local development

### `/api/diagnosis` - è¨ºæ–­å®Ÿè¡Œ
- **Method**: POST
- **Body**: `{ profiles: PrairieProfile[], mode: 'duo' | 'group' }`
- **Response**: è¨ºæ–­çµæœï¼ˆOpenAI GPT-4o-mini powered with fallbackï¼‰
- **Features**: 
  - 10 requests/minute rate limiting per IP
  - 10ç§’APIã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
  - Edge Runtime compatible
  - HTML sanitization & XSS protection

### `/api/prairie` - Prairie Cardè§£æ
- **Method**: POST  
- **Body**: `{ url: string } | { html: string }`
- **Response**: ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã•ã‚ŒãŸãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±
- **Features**: 
  - Edge Runtimeå¯¾å¿œé«˜é€Ÿãƒ‘ãƒ¼ã‚µãƒ¼
  - DOMPurify HTML sanitization
  - ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹ä»˜ã

### `/api/results/[id]` - çµæœå–å¾—/å‰Šé™¤
- **Methods**: GET, DELETE
- **Response**: ä¿å­˜ã•ã‚ŒãŸè¨ºæ–­çµæœ
- **Features**: KVã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰å–å¾—ï¼ˆ7æ—¥é–“è‡ªå‹•å‰Šé™¤ï¼‰

### Cloudflare Pages Functions (Production)
Located in `functions/*` - Used for production deployment on Cloudflare Pages
- **Runtime**: Cloudflare Workers Runtime
- **KV Storage**: Cloudflare Workers KV bindings
- **Edge Deployment**: Global edge network deployment

## ğŸ”§ ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰

é–‹ç™ºä¸­ã®ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚ã€è©³ç´°ãªãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

### æœ‰åŠ¹åŒ–æ–¹æ³•

```bash
# .env.development ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨­å®š
DEBUG_MODE=true
```

### ãƒ‡ãƒãƒƒã‚°æƒ…å ±

ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã¯ä»¥ä¸‹ã®æƒ…å ±ãŒã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã•ã‚Œã¾ã™ï¼š

#### Prairie Cardè§£æ
- HTMLã®é•·ã•ã¨ã‚µãƒ³ãƒ—ãƒ«ï¼ˆæœ€åˆã®500æ–‡å­—ï¼‰
- åå‰æŠ½å‡ºã®å€™è£œï¼ˆog:title, twitter:title, titleã‚¿ã‚°ç­‰ï¼‰  
- å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æŠ½å‡ºå€™è£œã¨æœ€çµ‚é¸æŠ
- æœ€çµ‚çš„ãªãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ§‹é€ 

#### è¨ºæ–­ã‚¨ãƒ³ã‚¸ãƒ³
- ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã•ã‚ŒãŸãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±
- OpenAIã¸é€ä¿¡ã•ã‚Œã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
- OpenAIã‹ã‚‰ã®ç”Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹
- ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡
- æœ€çµ‚çš„ãªè¨ºæ–­çµæœ

### ãƒ­ã‚°ä¾‹

```javascript
[DEBUG] Name extraction sources: {
  ogTitle: "ï¼¿ãƒ»ï¼‰ã¤ã‹ã¾ã‚“ ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«",
  twitterTitle: undefined,
  titleTag: "ï¼¿ãƒ»ï¼‰ã¤ã‹ã¾ã‚“ - Prairie Card"
}
[DEBUG] Name extracted with pattern 1: "ï¼¿ãƒ»ï¼‰ã¤ã‹ã¾ã‚“"
[DEBUG] Token usage: {
  prompt_tokens: 450,
  completion_tokens: 230,
  total_tokens: 680
}
```

**æ³¨æ„**: ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã¯é–‹ç™ºç’°å¢ƒã§ã®ã¿ä½¿ç”¨ã—ã€æœ¬ç•ªç’°å¢ƒã§ã¯ç„¡åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚

## ğŸŒ ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒ

### é–‹ç™ºç’°å¢ƒï¼ˆç¾åœ¨ç¨¼åƒä¸­ï¼‰
- **URL**: https://cnd2-app.pages.dev
- **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: Cloudflare Pages
- **Functions**: Cloudflare Workers
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: Cloudflare KV

### æœ¬ç•ªç’°å¢ƒï¼ˆå°†æ¥ï¼‰
- **URL**: https://cnd2.cloudnativedays.jp ï¼ˆâ€»é–‹ç™ºå®Œäº†å¾Œã«è¨­å®šï¼‰
- **ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³**: é–‹ç™ºå®Œäº†å¾Œã«Cloudflareã§è¨­å®š

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³](./CLAUDE.md) - é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€ã‚³ãƒ¼ãƒ‰è¦ç´„ã€ä»Šå¾Œã®ToDo
- [å¤‰æ›´å±¥æ­´](./CHANGELOG.md) - ãƒãƒ¼ã‚¸ãƒ§ãƒ³å±¥æ­´ã¨å¤‰æ›´å†…å®¹
- [ç’°å¢ƒå¤‰æ•°è¨­å®šã‚¬ã‚¤ãƒ‰](./docs/ENVIRONMENT_VARIABLES.md) - ã™ã¹ã¦ã®ç’°å¢ƒå¤‰æ•°ã®è©³ç´°èª¬æ˜
- [ã‚¤ãƒ™ãƒ³ãƒˆé‹ç”¨ã‚¬ã‚¤ãƒ‰](./docs/EVENT_OPERATION_GUIDE.md) - CloudNative Days Winter 2025é‹ç”¨æ‰‹é †
- [ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‰Šé™¤è¨ˆç”»](./docs/FALLBACK_REMOVAL_PLAN.md) - v1.6.0ã«å‘ã‘ãŸæ®µéšçš„å‰Šé™¤è¨ˆç”»

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
cnd2-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ api/                # APIãƒ«ãƒ¼ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ diagnosis/      # è¨ºæ–­API
â”‚   â”‚   â”‚   â””â”€â”€ prairie/        # Prairie Card API
â”‚   â”‚   â”œâ”€â”€ (main)/            # ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”‚   â”œâ”€â”€ result/            # çµæœãƒšãƒ¼ã‚¸
â”‚   â”‚   â””â”€â”€ layout.tsx         # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”œâ”€â”€ components/             # Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ diagnosis/         # è¨ºæ–­é–¢é€£
â”‚   â”‚   â”œâ”€â”€ prairie/           # Prairie Cardé–¢é€£
â”‚   â”‚   â”œâ”€â”€ share/             # å…±æœ‰æ©Ÿèƒ½
â”‚   â”‚   â””â”€â”€ ui/                # æ±ç”¨UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ hooks/                  # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”œâ”€â”€ lib/                    # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ api-middleware.ts  # APIãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â”‚   â”œâ”€â”€ api-errors.ts      # ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
â”‚   â”‚   â”œâ”€â”€ env.ts             # ç’°å¢ƒå¤‰æ•°æ¤œè¨¼
â”‚   â”‚   â”œâ”€â”€ rate-limiter.ts    # ãƒ¬ãƒ¼ãƒˆåˆ¶é™
â”‚   â”‚   â”œâ”€â”€ sentry-filters.ts  # Sentryã‚¨ãƒ©ãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
â”‚   â”‚   â””â”€â”€ workers/           # Cloudflare Workersé–¢é€£
â”‚   â”‚       â””â”€â”€ kv-storage.ts  # KVã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®Ÿè£…
â”‚   â””â”€â”€ types/                  # TypeScriptå‹å®šç¾©
â”œâ”€â”€ public/                     # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ __tests__/                  # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ package.json
```

### ä¸»è¦ãªå®Ÿè£…

#### APIãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ­ã‚®ãƒ³ã‚°
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆ10 requests/minute per IPï¼‰
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDè¿½è·¡
- HTML sanitization & XSS protection

#### è¨ºæ–­ã‚¨ãƒ³ã‚¸ãƒ³
- AIè¨ºæ–­ï¼ˆOpenAI GPT-4o-miniï¼‰
- ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹è¨ºæ–­ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹
- ä¸¦åˆ—å‡¦ç†å¯¾å¿œ
- Edge Runtime compatibility

#### Prairie Cardé€£æº
- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è‡ªå‹•å–å¾—ï¼ˆEdge Runtimeå¯¾å¿œï¼‰
- ãƒ‡ãƒ¼ã‚¿æ­£è¦åŒ– & DOMPurify sanitization
- ã‚¨ãƒ©ãƒ¼å‡¦ç†
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹ä»˜ã

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

```bash
# å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
npm test

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ
npm test -- src/lib/__tests__/api-middleware.test.ts

# ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
npm test -- --watch

# ã‚«ãƒãƒ¬ãƒ¼ã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
npm test -- --coverage
```

### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒ¼ã‚¸
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ: âœ…
- ãƒ•ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ: âœ…
- APIãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãƒ†ã‚¹ãƒˆ: âœ…
- ç’°å¢ƒå¤‰æ•°æ¤œè¨¼ãƒ†ã‚¹ãƒˆ: âœ…

## ğŸ“š APIä»•æ§˜

### POST /api/diagnosis
Prairie Cardã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã‹ã‚‰ç›¸æ€§è¨ºæ–­ã‚’ç”Ÿæˆ

```typescript
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
{
  profiles: PrairieProfile[],
  mode: 'duo' | 'group'
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  success: true,
  data: {
    result: DiagnosisResult,
    aiPowered: boolean
  }
}
```

### POST /api/prairie
Prairie Cardã®URLã‹ã‚‰ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã‚’å–å¾—

```typescript
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
{
  url: string
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  success: true,
  data: {
    profile: PrairieProfile,
    cacheStats: CacheStats
  }
}
```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- **ç’°å¢ƒå¤‰æ•°æ¤œè¨¼**: Zodã«ã‚ˆã‚‹å³å¯†ãªå‹ãƒã‚§ãƒƒã‚¯
- **APIã‚­ãƒ¼ä¿è­·**: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ã¿ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: æ‚ªç”¨é˜²æ­¢ã®ãŸã‚ã®åˆ¶é™æ©Ÿæ§‹ï¼ˆ10 requests/minute per IPï¼‰
- **CORSè¨­å®š**: é©åˆ‡ãªã‚ªãƒªã‚¸ãƒ³åˆ¶å¾¡
- **XSSå¯¾ç­–**: 
  - DOMPurify HTML sanitization
  - Reactæ¨™æº–ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†
  - CSPè¨­å®šï¼ˆunsafe-evalä¸ä½¿ç”¨ï¼‰
- **HTML Sanitization**: 
  - Prairie Card data sanitization
  - Allowed tags: p, br, strong, em, h1-h6, ul, ol, li, etc.
  - Dangerous protocol blocking: javascript:, data:, vbscript:
- **CSRFãƒˆãƒ¼ã‚¯ãƒ³**: Next.jsã®æ¨™æº–å®Ÿè£…
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼**: X-Frame-Optionsã€X-Content-Type-Optionsç­‰

## ğŸ“Š ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãƒ»ç›£è¦–

### Sentryçµ±åˆ
- **ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€ã‚µãƒ¼ãƒãƒ¼ã€ã‚¨ãƒƒã‚¸ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å…¨å¯¾å¿œ
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–**: ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³è¿½è·¡ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ è¨ˆæ¸¬
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒªãƒ—ãƒ¬ã‚¤**: ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‚’å†ç¾ï¼ˆæœ¬ç•ªç’°å¢ƒã®ã¿ï¼‰
- **ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: ãƒã‚¤ã‚ºé™¤å»ã€é‡è¦ã‚¨ãƒ©ãƒ¼ã®ã¿é€šçŸ¥

### è¨ºæ–­çµæœã®æ°¸ç¶šåŒ–
- **Cloudflare Workers KV**: è¨ºæ–­çµæœã®ä¿å­˜ã¨å–å¾—
- **è‡ªå‹•å‰Šé™¤**: 7æ—¥å¾Œã«è‡ªå‹•å‰Šé™¤ï¼ˆãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ï¼‰
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: KVãƒ¬ãƒ™ãƒ«ã§ã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™å®Ÿè£…

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤

### Development (ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º)
```bash
# é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
npm install
cp .env.example .env.local
# .env.localã«ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆNext.js API Routesä½¿ç”¨ï¼‰
npm run dev
```

### Production - Cloudflare Pagesï¼ˆæ¨å¥¨ï¼‰
æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯é™çš„ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ + Cloudflare Pages Functions ã§æœ¬ç•ªé‹ç”¨

```bash
# ãƒ“ãƒ«ãƒ‰ï¼ˆé™çš„ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼‰
npm run build

# Wrangler CLIã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤
npx wrangler pages deploy out

# ã¾ãŸã¯ã€Cloudflare Dashboardã‹ã‚‰GitHubé€£æºã§ãƒ‡ãƒ—ãƒ­ã‚¤
```

#### Cloudflare Pagesè¨­å®š
- **ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰**: `npm run build`
- **å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**: `out`
- **Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 20.x
- **Functions**: `functions/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
- **KV Namespace**: `DIAGNOSIS_KV` bindingå¿…é ˆ
- **ç’°å¢ƒå¤‰æ•°**: Cloudflare Dashboardã§è¨­å®š
  - `OPENAI_API_KEY`
  - `ALLOWED_ORIGINS`
  - `KV_NAMESPACE`

### Vercelï¼ˆä»£æ›¿ï¼‰
```bash
# Vercel CLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm i -g vercel

# ãƒ‡ãƒ—ãƒ­ã‚¤
vercel
```

**æ³¨æ„**: Vercelã¯å•†æ¥­ã‚¤ãƒ™ãƒ³ãƒˆåˆ©ç”¨æ™‚ã«æœ‰æ–™ãƒ—ãƒ©ãƒ³ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™ã€‚

### Docker
```bash
# ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰
docker build -t cnd2-app .

# ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•
docker run -p 3000:3000 cnd2-app
```

## ğŸ¤ è²¢çŒ®

è²¢çŒ®ã‚’æ­“è¿ã—ã¾ã™ï¼è©³ç´°ã¯[CONTRIBUTING.md](./CONTRIBUTING.md)ã‚’ã”è¦§ãã ã•ã„ã€‚

1. ãƒ•ã‚©ãƒ¼ã‚¯
2. æ©Ÿèƒ½ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ (`git checkout -b feature/amazing-feature`)
3. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ (`git commit -m 'feat: Add amazing feature'`)
4. ãƒ—ãƒƒã‚·ãƒ¥ (`git push origin feature/amazing-feature`)
5. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ

## ğŸ‘¨â€ğŸ’» ä½œè€…

**ã¤ã‹ã¾ã‚“** - [@tsukaman](https://twitter.com/tsukaman)

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯Apache License 2.0ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚è©³ç´°ã¯[LICENSE](./LICENSE)ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã”è¦§ãã ã•ã„ã€‚

## ğŸŒŸ æœ€è¿‘ã®æ›´æ–°

### v1.3.0 (2025-08-31)
- ğŸ‰ è¤‡æ•°ã‚¹ã‚¿ã‚¤ãƒ«åŒæ™‚è¨ºæ–­æ©Ÿèƒ½
- âš¡ Promise.allã«ã‚ˆã‚‹ä¸¦åˆ—å‡¦ç†ï¼ˆ75%é«˜é€ŸåŒ–ã€2-3ç§’ã§å®Œäº†ï¼‰
- ğŸ¨ 4ã¤ã®è¨ºæ–­ã‚¹ã‚¿ã‚¤ãƒ«åŒæ™‚å®Ÿè¡Œ
- ğŸ“Š ã‚¿ãƒ–/ã‚°ãƒªãƒƒãƒ‰åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ãªæ¯”è¼ƒUI
- ğŸ’° ã‚³ã‚¹ãƒˆåŠ¹ç‡çš„ãªå®Ÿè£…ï¼ˆç´„0.6å††/è¨ºæ–­ï¼‰

### v1.2.0 (2025-08-26)
- ğŸ¤– AI diagnosis with OpenAI GPT-4o-mini integration
- ğŸ›¡ï¸ HTML sanitization & XSS protection with DOMPurify
- âš¡ Prairie Card parsing with Edge Runtime compatibility
- ğŸš¦ Rate limiting (10 requests/minute per IP)
- ğŸ”„ Dual API implementation (Next.js Routes + Cloudflare Functions)
- ğŸ“ TypeScript strict mode enabled
- âœ… Test suite expanded to 76 tests
- ğŸš€ Static export for Cloudflare Pages deployment

## ğŸ™ è¬è¾

- [CloudNative Days Committee](https://cloudnativedays.jp/) - ã‚¤ãƒ™ãƒ³ãƒˆä¸»å‚¬
- [Prairie Card](https://prairie.cards/) - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ æä¾›ï¼ˆPowered by Prairie Cardï¼‰
- [Claude](https://claude.ai) - AIé–‹ç™ºã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
- ã™ã¹ã¦ã®ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ¼ã¨ãƒ†ã‚¹ã‚¿ãƒ¼

## ğŸ“Š ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.3.1
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Production Ready
- **æœ€çµ‚æ›´æ–°**: 2025å¹´9æœˆ1æ—¥
- **ãƒ†ã‚¹ãƒˆ**: å…¨460ãƒ†ã‚¹ãƒˆï¼ˆ419åˆæ ¼ã€41ã‚¹ã‚­ãƒƒãƒ—ï¼‰ âœ…
- **ãƒ“ãƒ«ãƒ‰**: é™çš„ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæˆåŠŸ âœ…
- **API**: 
  - Next.js API Routes (development) âœ…
  - Cloudflare Pages Functions (production) âœ…
- **AI Integration**: OpenAI GPT-4o-miniè¨ºæ–­ âœ…
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: 
  - HTML sanitization & XSS protection âœ…
  - Rate limiting (10 req/min per IP) âœ…
  - CSPå¼·åŒ–æ¸ˆã¿ âœ…
  - CORSè¨­å®šæœ€é©åŒ– âœ…
  - æ©Ÿå¯†æƒ…å ±ã‚µãƒ‹ã‚¿ã‚¤ã‚º âœ…
- **Runtime**: Edge Runtime compatibility âœ…
- **TypeScript**: Strict mode enabled âœ…
- **ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°**: Sentryçµ±åˆæ¸ˆã¿ âœ…

---

<div align="center">
  Made with â¤ï¸ for CloudNative Days Winter 2025
</div>